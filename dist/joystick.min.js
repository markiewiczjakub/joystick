var Joystick=function(t){var s={};function i(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var n in t)i.d(e,n,function(s){return t[s]}.bind(null,n));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){const e=i(1).default;t.exports=e},function(t,s,i){"use strict";i.r(s),i.d(s,"default",(function(){return h}));class e{static uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var s=16*Math.random()|0;return("x"==t?s:3&s|8).toString(16)}))}static getCursorPosition(t){let s,i;return t instanceof MouseEvent?(s=t.pageX,i=t.pageY):t instanceof TouchEvent&&(s=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY),{x:s,y:i}}}e.width=100,e.height=100,e.color="#FF0000",e.strokeColor="#000000";class n{constructor(t,s){this.x=t,this.y=s,this.x=t||0,this.y=s||0}negative(){return this.x=-this.x,this.y=-this.y,this}add(t){return t instanceof n?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t),this}subtract(t){return t instanceof n?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=t),this}multiply(t){return t instanceof n?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this}divide(t){return t instanceof n?(0!=t.x&&(this.x/=t.x),0!=t.y&&(this.y/=t.y)):0!=t&&(this.x/=t,this.y/=t),this}equals(t){return this.x==t.x&&this.y==t.y}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Math.sqrt(this.dot(this))}normalize(){return this.divide(this.length())}min(){return Math.min(this.x,this.y)}max(){return Math.max(this.x,this.y)}toAngles(){return-Math.atan2(-this.y,this.x)}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y].slice(0,t||2)}clone(){return new n(this.x,this.y)}set(t,s){return this.x=t,this.y=s,this}}class o{constructor(t){this.joystick=t,this.canvas=document.createElement("canvas"),this.canvas.id=e.uuidv4(),this.canvas.width=e.width*this.joystick.options.scale,this.canvas.height=e.height*this.joystick.options.scale,this.canvasContext=this.canvas.getContext("2d"),this.joystick.domElement.appendChild(this.canvas),this.circleRadius={background:this.canvas.width/2-3*this.joystick.options.scale,joystick:this.canvas.width/2-20*this.joystick.options.scale,joystickStroke:this.canvas.width/2-21.5*this.joystick.options.scale},this.maxLength=this.canvas.width/2-this.circleRadius.joystick,this.joystickPoistion={x:this.canvas.width/2,y:this.canvas.height/2},this.bindEvents(),this.draw()}calculate(t,s){let i=new n(this.canvas.offsetLeft+this.canvas.width/2,this.canvas.offsetTop+this.canvas.height/2),e=new n(t,s).subtract(i);e.length()>this.maxLength&&(e.normalize(),e.multiply(this.maxLength)),this.joystickPoistion.x=e.x+this.canvas.width/2,this.joystickPoistion.y=e.y+this.canvas.width/2,e.divide(this.maxLength),this.joystick.update(e.x,e.y)}bindEvents(){const t=(t,s)=>{if(!1===s&&!0===this.joystick.draw&&this.joystick.dispatch("end",this.joystick),!1===s)return this.joystickPoistion.x=this.canvas.width/2,this.joystickPoistion.y=this.canvas.height/2,this.joystick.update(0,0),void(this.joystick.draw=s);this.joystick.draw=s,this.joystick.dispatch("start",this.joystick);const i=e.getCursorPosition(t);this.calculate(i.x,i.y)},s=t=>{if(!this.joystick.draw)return;const s=e.getCursorPosition(t);this.calculate(s.x,s.y)};this.canvas.addEventListener("mousedown",s=>t(s,!0)),document.addEventListener("mouseup",s=>t(s,!1)),document.addEventListener("mousemove",t=>s(t)),this.canvas.addEventListener("touchstart",s=>t(s,!0)),document.addEventListener("touchend",s=>t(s,!1)),document.addEventListener("touchmove",t=>s(t))}drawBackground(){this.canvasContext.beginPath(),this.canvasContext.lineWidth=3*this.joystick.options.scale,this.canvasContext.strokeStyle=this.joystick.options.color,this.canvasContext.arc(this.canvas.width/2,this.canvas.height/2,this.circleRadius.background,0,2*Math.PI),this.canvasContext.stroke()}drawJoystick(t,s){this.canvasContext.beginPath(),this.canvasContext.arc(t,s,this.circleRadius.joystick,0,2*Math.PI),this.canvasContext.fillStyle=this.joystick.options.color,this.canvasContext.fill(),this.canvasContext.beginPath(),this.canvasContext.arc(t,s,this.circleRadius.joystickStroke,0,2*Math.PI),this.canvasContext.strokeStyle=this.joystick.options.strokeColor,this.canvasContext.stroke()}draw(){this.canvasContext&&(this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.drawJoystick(this.joystickPoistion.x,this.joystickPoistion.y),this.joystick.draw&&window.requestAnimationFrame(()=>this.draw()))}}class a{constructor(t){this.eventName=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}unregisterCallback(t){const s=this.callbacks.indexOf(t);s>-1&&this.callbacks.splice(s,1)}fire(t){this.callbacks.slice(0).forEach(s=>{s(t)})}}class h extends class{constructor(){this.events={}}dispatch(t,s){const i=this.events[t];i&&i.fire(s)}on(t,s){let i=this.events[t];i||(i=new a(t),this.events[t]=i),i.registerCallback(s)}off(t,s){const i=this.events[t];i&&i.callbacks.indexOf(s)>-1&&(i.unregisterCallback(s),0===i.callbacks.length&&delete this.events[t])}}{constructor(t,s){super(),this.domElement=t,this.options=s,this._draw=!1,this.domElement=t||document.querySelector("#joystick"),this.domElement?(this.options=s||{},this.options.scale=this.options.scale||1,this.options.color=this.options.color||e.color,this.options.strokeColor=this.options.strokeColor||e.strokeColor,this.init()):console.error("ERROR: Could not find #joystick HTMLElement.")}get draw(){return this._draw}set draw(t){(t||this.draw)&&(this._draw=t,this.canvasHander.draw())}init(){this.canvasHander=new o(this)}update(t,s){this.dirVector=new n(t,s),this.dispatch("change",this)}directionVector(){return{x:this.dirVector.x,y:this.dirVector.y}}directionAngleRads(){return 0!==this.dirVector.length()&&this.dirVector.toAngles()}directionAngleDegs(){return!!this.directionAngleRads()&&180*this.directionAngleRads()/Math.PI}direction(){if(this.directionAngleRads()){const t=Math.round(this.directionAngleDegs())+450;return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.floor(t/22.5+.5)%16]}return!1}displacementValue(){return this.dirVector.length()}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Kb3lzdGljay93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Kb3lzdGljay8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9Kb3lzdGljay8uL3NyYy9VdGlscy50cyIsIndlYnBhY2s6Ly9Kb3lzdGljay8uL3NyYy9WZWN0b3IudHMiLCJ3ZWJwYWNrOi8vSm95c3RpY2svLi9zcmMvQ2FudmFzSGFuZGxlci50cyIsIndlYnBhY2s6Ly9Kb3lzdGljay8uL3NyYy9EaXNwYXRjaGVyLnRzIiwid2VicGFjazovL0pveXN0aWNrLy4vc3JjL0pveXN0aWNrLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiSm95c3RpY2siLCJkZWZhdWx0IiwiVXRpbHMiLCJyZXBsYWNlIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwiZXZlbnQiLCJ4IiwieSIsIk1vdXNlRXZlbnQiLCJwYWdlWCIsInBhZ2VZIiwiVG91Y2hFdmVudCIsImNoYW5nZWRUb3VjaGVzIiwid2lkdGgiLCJoZWlnaHQiLCJjb2xvciIsInN0cm9rZUNvbG9yIiwiVmVjdG9yIiwidGhpcyIsInYiLCJzcXJ0IiwiZG90IiwiZGl2aWRlIiwibGVuZ3RoIiwibWluIiwibWF4IiwiYXRhbjIiLCJhIiwiYWNvcyIsInNsaWNlIiwiam95c3RpY2siLCJjYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsInV1aWR2NCIsIm9wdGlvbnMiLCJzY2FsZSIsImNhbnZhc0NvbnRleHQiLCJnZXRDb250ZXh0IiwiZG9tRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY2lyY2xlUmFkaXVzIiwiYmFja2dyb3VuZCIsImpveXN0aWNrU3Ryb2tlIiwibWF4TGVuZ3RoIiwiam95c3RpY2tQb2lzdGlvbiIsImJpbmRFdmVudHMiLCJkcmF3Iiwiam95c3RpY2tWZWN0b3IiLCJvZmZzZXRMZWZ0Iiwib2Zmc2V0VG9wIiwiZmluYWxWZWN0b3IiLCJzdWJ0cmFjdCIsIm5vcm1hbGl6ZSIsIm11bHRpcGx5IiwidXBkYXRlIiwiaGFuZGxlQ2xpY2tFdmVudCIsInN0YXRlIiwiZGlzcGF0Y2giLCJwb3MiLCJnZXRDdXJzb3JQb3NpdGlvbiIsImNhbGN1bGF0ZSIsImhhbmRsZU1vdmVFdmVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiYmVnaW5QYXRoIiwibGluZVdpZHRoIiwic3Ryb2tlU3R5bGUiLCJhcmMiLCJQSSIsInN0cm9rZSIsImZpbGxTdHlsZSIsImZpbGwiLCJjbGVhclJlY3QiLCJkcmF3QmFja2dyb3VuZCIsImRyYXdKb3lzdGljayIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIkRpc3BhdGNoZXJFdmVudCIsImV2ZW50TmFtZSIsImNhbGxiYWNrcyIsImNhbGxiYWNrIiwicHVzaCIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImRhdGEiLCJmb3JFYWNoIiwiZXZlbnRzIiwiZmlyZSIsInJlZ2lzdGVyQ2FsbGJhY2siLCJ1bnJlZ2lzdGVyQ2FsbGJhY2siLCJzdXBlciIsIl9kcmF3IiwicXVlcnlTZWxlY3RvciIsImluaXQiLCJjb25zb2xlIiwiZXJyb3IiLCJjYW52YXNIYW5kZXIiLCJkaXJWZWN0b3IiLCJ0b0FuZ2xlcyIsImRpcmVjdGlvbkFuZ2xlUmFkcyIsImFuZ2xlIiwicm91bmQiLCJkaXJlY3Rpb25B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QkFDSSxRQUFHbkYsS0FBS29GLHNCQUMrQixJQUE1QnBGLEtBQUtvRixxQkFBNkJwRyxLQUFLb0UsR0FLdEQsWUFDSSxHQUFHcEQsS0FBS29GLHFCQUFxQixDQUN6QixNQUFNQyxFQUFnQnJHLEtBQUtzRyxNQUFNdEYsS0FBS3VGLHNCQUF3QixJQUc5RCxNQUR5QixDQUFDLElBQUssTUFBTyxLQUFNLE1BQU8sSUFBSyxNQUFPLEtBQU0sTUFBTyxJQUFLLE1BQU8sS0FBTSxNQUFPLElBQUssTUFBTyxLQUFNLE9BRHJHdkcsS0FBS3dHLE1BQU9ILEVBQVEsS0FBUSxJQUU1QixJQUVsQixPQUFPLEVBR2Ysb0JBQ0ksT0FBT3JGLEtBQUtrRixVQUFVN0UiLCJmaWxlIjoiam95c3RpY2subWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiY29uc3QgSm95c3RpY2sgPSByZXF1aXJlKCcuL0pveXN0aWNrJykuZGVmYXVsdDtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gSm95c3RpY2s7IiwiZXhwb3J0IGNsYXNzIFV0aWxzIHtcclxuICAgIHN0YXRpYyB3aWR0aDogbnVtYmVyID0gMTAwO1xyXG4gICAgc3RhdGljIGhlaWdodDogbnVtYmVyID0gMTAwO1xyXG4gICAgc3RhdGljIGNvbG9yOiBzdHJpbmcgPSBcIiNGRjAwMDBcIjtcclxuICAgIHN0YXRpYyBzdHJva2VDb2xvcjogc3RyaW5nID0gXCIjMDAwMDAwXCI7XHJcblxyXG4gICAgc3RhdGljIHV1aWR2NCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgIHZhciByOiBudW1iZXIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLCB2ID0gYyA9PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xyXG4gICAgICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRDdXJzb3JQb3NpdGlvbihldmVudDogYW55KTogYW55IHtcclxuICAgICAgICBsZXQgeDogbnVtYmVyO1xyXG4gICAgICAgIGxldCB5OiBudW1iZXI7XHJcblxyXG4gICAgICAgIGlmKGV2ZW50IGluc3RhbmNlb2YgTW91c2VFdmVudCl7XHJcbiAgICAgICAgICAgIHggPSBldmVudC5wYWdlWDtcclxuICAgICAgICAgICAgeSA9IGV2ZW50LnBhZ2VZO1xyXG4gICAgICAgIH1lbHNlIGlmKGV2ZW50IGluc3RhbmNlb2YgVG91Y2hFdmVudCl7XHJcbiAgICAgICAgICAgIHggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgeSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge3g6IHgsIHk6IHl9OyAgXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgVmVjdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyB4OiBudW1iZXIsIHB1YmxpYyB5OiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMueCA9IHggfHwgMDtcclxuICAgICAgICB0aGlzLnkgPSB5IHx8IDA7XHJcbiAgICB9XHJcblxyXG5cdG5lZ2F0aXZlICgpOiBWZWN0b3Ige1xyXG5cdFx0dGhpcy54ID0gLXRoaXMueDtcclxuXHRcdHRoaXMueSA9IC10aGlzLnk7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIFxyXG5cdGFkZCAodjogYW55KTogVmVjdG9yICB7XHJcblx0XHRpZiAodiBpbnN0YW5jZW9mIFZlY3Rvcikge1xyXG5cdFx0XHR0aGlzLnggKz0gdi54O1xyXG5cdFx0XHR0aGlzLnkgKz0gdi55O1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy54ICs9IHY7XHJcblx0XHRcdHRoaXMueSArPSB2O1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBcclxuXHRzdWJ0cmFjdCAodjogYW55KTogVmVjdG9yIHtcclxuXHRcdGlmICh2IGluc3RhbmNlb2YgVmVjdG9yKSB7XHJcblx0XHRcdHRoaXMueCAtPSB2Lng7XHJcblx0XHRcdHRoaXMueSAtPSB2Lnk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnggLT0gdjtcclxuXHRcdFx0dGhpcy55IC09IHY7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIFxyXG5cdG11bHRpcGx5ICh2OiBhbnkpOiBWZWN0b3IgIHtcclxuXHRcdGlmICh2IGluc3RhbmNlb2YgVmVjdG9yKSB7XHJcblx0XHRcdHRoaXMueCAqPSB2Lng7XHJcblx0XHRcdHRoaXMueSAqPSB2Lnk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnggKj0gdjtcclxuXHRcdFx0dGhpcy55ICo9IHY7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIFxyXG5cdGRpdmlkZSAodjogYW55KTogVmVjdG9yICB7XHJcblx0XHRpZiAodiBpbnN0YW5jZW9mIFZlY3Rvcikge1xyXG5cdFx0XHRpZih2LnggIT0gMCkgdGhpcy54IC89IHYueDtcclxuXHRcdFx0aWYodi55ICE9IDApIHRoaXMueSAvPSB2Lnk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZih2ICE9IDApIHtcclxuXHRcdFx0XHR0aGlzLnggLz0gdjtcclxuXHRcdFx0XHR0aGlzLnkgLz0gdjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBcclxuXHRlcXVhbHMgKHY6IGFueSk6IGJvb2xlYW4gIHtcclxuXHRcdHJldHVybiB0aGlzLnggPT0gdi54ICYmIHRoaXMueSA9PSB2Lnk7XHJcbiAgICB9XHJcbiAgICBcclxuXHRkb3QgKHY6IGFueSk6IG51bWJlciAge1xyXG5cdFx0cmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueTtcclxuICAgIH1cclxuICAgIFxyXG5cdGNyb3NzICh2OiBhbnkpOiBudW1iZXIgIHtcclxuXHRcdHJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2LnhcclxuICAgIH1cclxuICAgIFxyXG5cdGxlbmd0aCAoKTogbnVtYmVyICB7XHJcblx0XHRyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZG90KHRoaXMpKTtcclxuICAgIH1cclxuICAgIFxyXG5cdG5vcm1hbGl6ZSAoKTogVmVjdG9yIHtcclxuXHRcdHJldHVybiB0aGlzLmRpdmlkZSh0aGlzLmxlbmd0aCgpKTtcclxuICAgIH1cclxuICAgIFxyXG5cdG1pbiAoKTogbnVtYmVyICB7XHJcblx0XHRyZXR1cm4gTWF0aC5taW4odGhpcy54LCB0aGlzLnkpO1xyXG4gICAgfVxyXG4gICAgXHJcblx0bWF4ICgpOiBudW1iZXIgIHtcclxuXHRcdHJldHVybiBNYXRoLm1heCh0aGlzLngsIHRoaXMueSk7XHJcbiAgICB9XHJcbiAgICBcclxuXHR0b0FuZ2xlcyAoKTogbnVtYmVyICB7XHJcblx0XHRyZXR1cm4gLU1hdGguYXRhbjIoLXRoaXMueSwgdGhpcy54KTtcclxuICAgIH1cclxuICAgIFxyXG5cdGFuZ2xlVG8gKGE6IGFueSk6IG51bWJlciAge1xyXG5cdFx0cmV0dXJuIE1hdGguYWNvcyh0aGlzLmRvdChhKSAvICh0aGlzLmxlbmd0aCgpICogYS5sZW5ndGgoKSkpO1xyXG4gICAgfVxyXG4gICAgXHJcblx0dG9BcnJheSAobjogbnVtYmVyKTogQXJyYXk8bnVtYmVyPiAge1xyXG5cdFx0cmV0dXJuIFt0aGlzLngsIHRoaXMueV0uc2xpY2UoMCwgbiB8fCAyKTtcclxuICAgIH1cclxuICAgIFxyXG5cdGNsb25lICgpOiBWZWN0b3IgIHtcclxuXHRcdHJldHVybiBuZXcgVmVjdG9yKHRoaXMueCwgdGhpcy55KTtcclxuICAgIH1cclxuICAgIFxyXG5cdHNldCAoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBWZWN0b3IgIHtcclxuXHRcdHRoaXMueCA9IHg7IHRoaXMueSA9IHk7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcbn0iLCJpbXBvcnQgSm95c3RpY2sgZnJvbSBcIi4vSm95c3RpY2tcIjtcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tIFwiLi9VdGlsc1wiO1xyXG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi9WZWN0b3JcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDYW52YXNIYW5kbGVyIHtcclxuICAgIHB1YmxpYyBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBjYW52YXNDb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICBwcml2YXRlIG1heExlbmd0aDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBjaXJjbGVSYWRpdXM6IGFueTtcclxuICAgIHB1YmxpYyBqb3lzdGlja1BvaXN0aW9uOiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBqb3lzdGljazogSm95c3RpY2spe1xyXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5pZCA9IFV0aWxzLnV1aWR2NCgpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gVXRpbHMud2lkdGggKiB0aGlzLmpveXN0aWNrLm9wdGlvbnMuc2NhbGU7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gVXRpbHMuaGVpZ2h0ICogdGhpcy5qb3lzdGljay5vcHRpb25zLnNjYWxlO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5qb3lzdGljay5kb21FbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY2FudmFzKTtcclxuXHJcbiAgICAgICAgLy8gbWF4IHZlY3RvcidzIGxlbmd0aFxyXG4gICAgICAgIHRoaXMuY2lyY2xlUmFkaXVzID0ge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB0aGlzLmNhbnZhcy53aWR0aC8yIC0gKDMgKiB0aGlzLmpveXN0aWNrLm9wdGlvbnMuc2NhbGUpLFxyXG4gICAgICAgICAgICBqb3lzdGljazogdGhpcy5jYW52YXMud2lkdGgvMiAtICgyMCAqIHRoaXMuam95c3RpY2sub3B0aW9ucy5zY2FsZSksXHJcbiAgICAgICAgICAgIGpveXN0aWNrU3Ryb2tlOiB0aGlzLmNhbnZhcy53aWR0aC8yIC0gKDIxLjUgKiB0aGlzLmpveXN0aWNrLm9wdGlvbnMuc2NhbGUpLFxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1heExlbmd0aCA9IHRoaXMuY2FudmFzLndpZHRoLzIgIC0gdGhpcy5jaXJjbGVSYWRpdXMuam95c3RpY2s7XHJcblxyXG4gICAgICAgIHRoaXMuam95c3RpY2tQb2lzdGlvbiA9IHtcclxuICAgICAgICAgICAgeDogdGhpcy5jYW52YXMud2lkdGgvMixcclxuICAgICAgICAgICAgeTogdGhpcy5jYW52YXMuaGVpZ2h0LzJcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xyXG4gICAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbGN1bGF0ZSh4OiBudW1iZXIsIHk6IG51bWJlcil7XHJcbiAgICAgICAgbGV0IGpveXN0aWNrVmVjdG9yOiBWZWN0b3IgPSBuZXcgVmVjdG9yKHRoaXMuY2FudmFzLm9mZnNldExlZnQgKyB0aGlzLmNhbnZhcy53aWR0aC8yLCB0aGlzLmNhbnZhcy5vZmZzZXRUb3AgKyB0aGlzLmNhbnZhcy5oZWlnaHQvMik7XHJcbiAgICAgICAgbGV0IGNsaWNrVmVjdG9yOiBWZWN0b3IgPSBuZXcgVmVjdG9yKHgsIHkpO1xyXG5cclxuICAgICAgICBsZXQgZmluYWxWZWN0b3I6IFZlY3RvciA9IGNsaWNrVmVjdG9yLnN1YnRyYWN0KGpveXN0aWNrVmVjdG9yKTtcclxuICAgICAgICBpZihmaW5hbFZlY3Rvci5sZW5ndGgoKSA+IHRoaXMubWF4TGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGZpbmFsVmVjdG9yLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgICAgICBmaW5hbFZlY3Rvci5tdWx0aXBseSh0aGlzLm1heExlbmd0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmpveXN0aWNrUG9pc3Rpb24ueCA9IGZpbmFsVmVjdG9yLnggKyB0aGlzLmNhbnZhcy53aWR0aC8yO1xyXG4gICAgICAgIHRoaXMuam95c3RpY2tQb2lzdGlvbi55ID0gZmluYWxWZWN0b3IueSArIHRoaXMuY2FudmFzLndpZHRoLzI7XHJcblxyXG4gICAgICAgIGZpbmFsVmVjdG9yLmRpdmlkZSh0aGlzLm1heExlbmd0aCk7XHJcbiAgICAgICAgdGhpcy5qb3lzdGljay51cGRhdGUoZmluYWxWZWN0b3IueCwgZmluYWxWZWN0b3IueSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmluZEV2ZW50cygpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBoYW5kbGVDbGlja0V2ZW50ID0gKGV2ZW50OiBhbnksIHN0YXRlOiBib29sZWFuKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGlmKHN0YXRlID09PSBmYWxzZSAmJiB0aGlzLmpveXN0aWNrLmRyYXcgPT09IHRydWUpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmpveXN0aWNrLmRpc3BhdGNoKFwiZW5kXCIsIHRoaXMuam95c3RpY2spO1xyXG4gICAgICAgICAgICBpZihzdGF0ZSA9PT0gZmFsc2Upe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qb3lzdGlja1BvaXN0aW9uLnggPSB0aGlzLmNhbnZhcy53aWR0aC8yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qb3lzdGlja1BvaXN0aW9uLnkgPSB0aGlzLmNhbnZhcy5oZWlnaHQvMjtcclxuICAgICAgICAgICAgICAgIHRoaXMuam95c3RpY2sudXBkYXRlKDAsIDApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qb3lzdGljay5kcmF3ID0gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5qb3lzdGljay5kcmF3ID0gc3RhdGU7XHJcbiAgICAgICAgICAgIHRoaXMuam95c3RpY2suZGlzcGF0Y2goXCJzdGFydFwiLCB0aGlzLmpveXN0aWNrKTtcclxuICAgICAgICAgICAgY29uc3QgcG9zID0gVXRpbHMuZ2V0Q3Vyc29yUG9zaXRpb24oZXZlbnQpOyBcclxuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGUocG9zLngsIHBvcy55KTsgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaGFuZGxlTW92ZUV2ZW50ID0gKGV2ZW50OiBhbnkpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgaWYoIXRoaXMuam95c3RpY2suZHJhdykgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcG9zID0gVXRpbHMuZ2V0Q3Vyc29yUG9zaXRpb24oZXZlbnQpOyBcclxuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGUocG9zLngsIHBvcy55KTsgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBmb3IgZGVrc3RvcFxyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IGhhbmRsZUNsaWNrRXZlbnQoZSwgdHJ1ZSkpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIChlKSA9PiBoYW5kbGVDbGlja0V2ZW50KGUsIGZhbHNlKSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCAoZSkgPT4gaGFuZGxlTW92ZUV2ZW50KGUpKTtcclxuXHJcbiAgICAgICAgLy8gZm9yIG1vYmlsZVxyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIChlKSA9PiBoYW5kbGVDbGlja0V2ZW50KGUsIHRydWUpKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGUpID0+IGhhbmRsZUNsaWNrRXZlbnQoZSwgZmFsc2UpKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIChlKSA9PiBoYW5kbGVNb3ZlRXZlbnQoZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGRyYXdCYWNrZ3JvdW5kKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQubGluZVdpZHRoID0gMyAqIHRoaXMuam95c3RpY2sub3B0aW9ucy5zY2FsZTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuc3Ryb2tlU3R5bGUgPSB0aGlzLmpveXN0aWNrLm9wdGlvbnMuY29sb3I7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LmFyYyh0aGlzLmNhbnZhcy53aWR0aC8yLCB0aGlzLmNhbnZhcy5oZWlnaHQvMiwgdGhpcy5jaXJjbGVSYWRpdXMuYmFja2dyb3VuZCwgMCwgMipNYXRoLlBJKTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd0pveXN0aWNrKHg6IG51bWJlciwgeTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5hcmMoeCwgeSwgdGhpcy5jaXJjbGVSYWRpdXMuam95c3RpY2ssIDAsIDIqTWF0aC5QSSlcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5qb3lzdGljay5vcHRpb25zLmNvbG9yO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5maWxsKCk7XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuYXJjKHgsIHksIHRoaXMuY2lyY2xlUmFkaXVzLmpveXN0aWNrU3Ryb2tlLCAwLCAyKk1hdGguUEkpXHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LnN0cm9rZVN0eWxlID0gdGhpcy5qb3lzdGljay5vcHRpb25zLnN0cm9rZUNvbG9yO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5zdHJva2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIGlmKCF0aGlzLmNhbnZhc0NvbnRleHQpIHJldHVybjtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuZHJhd0JhY2tncm91bmQoKTtcclxuICAgICAgICB0aGlzLmRyYXdKb3lzdGljayh0aGlzLmpveXN0aWNrUG9pc3Rpb24ueCwgdGhpcy5qb3lzdGlja1BvaXN0aW9uLnkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGNoZWNrIHdoZXRoZXIgam95c3RpY2sgbmVlZHMgdG8gbW92ZVxyXG4gICAgICAgIGlmKHRoaXMuam95c3RpY2suZHJhdylcclxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmRyYXcoKSk7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBEaXNwYXRjaGVyRXZlbnQge1xyXG4gICAgcHVibGljIGV2ZW50TmFtZTogc3RyaW5nO1xyXG4gICAgcHVibGljIGNhbGxiYWNrczogQXJyYXk8YW55PjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihldmVudE5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJDYWxsYmFjayhjYWxsYmFjazogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3MucHVzaChjYWxsYmFjayk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5yZWdpc3RlckNhbGxiYWNrKGNhbGxiYWNrOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpcmUoZGF0YTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gdGhpcy5jYWxsYmFja3Muc2xpY2UoMCk7XHJcbiAgICAgICAgY2FsbGJhY2tzLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRGlzcGF0Y2hlciB7XHJcbiAgICBwdWJsaWMgZXZlbnRzOiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5ldmVudHMgPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwYXRjaChldmVudE5hbWU6IHN0cmluZywgZGF0YTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLmV2ZW50c1tldmVudE5hbWVdO1xyXG4gICAgICAgIGlmIChldmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5maXJlKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGxldCBldmVudCA9IHRoaXMuZXZlbnRzW2V2ZW50TmFtZV07XHJcbiAgICAgICAgaWYgKCFldmVudCkge1xyXG4gICAgICAgICAgICBldmVudCA9IG5ldyBEaXNwYXRjaGVyRXZlbnQoZXZlbnROYW1lKTtcclxuICAgICAgICAgICAgdGhpcy5ldmVudHNbZXZlbnROYW1lXSA9IGV2ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBldmVudC5yZWdpc3RlckNhbGxiYWNrKGNhbGxiYWNrKTtcclxuICAgIH1cclxuXHJcbiAgICBvZmYoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBldmVudCA9IHRoaXMuZXZlbnRzW2V2ZW50TmFtZV07XHJcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LmNhbGxiYWNrcy5pbmRleE9mKGNhbGxiYWNrKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnVucmVnaXN0ZXJDYWxsYmFjayhjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5jYWxsYmFja3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5ldmVudHNbZXZlbnROYW1lXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImltcG9ydCB7IENhbnZhc0hhbmRsZXIgfSBmcm9tIFwiLi9DYW52YXNIYW5kbGVyXCI7XHJcbmltcG9ydCB7IERpc3BhdGNoZXIgfSBmcm9tIFwiLi9EaXNwYXRjaGVyXCI7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSBcIi4vVXRpbHNcIjtcclxuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSBcIi4vVmVjdG9yXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKb3lzdGljayBleHRlbmRzIERpc3BhdGNoZXIge1xyXG4gICAgcHJpdmF0ZSBjYW52YXNIYW5kZXI6IENhbnZhc0hhbmRsZXI7XHJcbiAgICBwdWJsaWMgX2RyYXc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZGlyVmVjdG9yOiBWZWN0b3I7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGRvbUVsZW1lbnQ6IEhUTUxFbGVtZW50LCBwdWJsaWMgb3B0aW9uczogYW55KXtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNqb3lzdGlja1wiKTtcclxuICAgICAgICBpZighdGhpcy5kb21FbGVtZW50KVxyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRVJST1I6IENvdWxkIG5vdCBmaW5kICNqb3lzdGljayBIVE1MRWxlbWVudC5cIik7XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICAgICAgICAgIC8vIGhhbmRsaW5nIG9wdGlvbnNcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNjYWxlID0gdGhpcy5vcHRpb25zLnNjYWxlIHx8IDE7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5jb2xvciA9IHRoaXMub3B0aW9ucy5jb2xvciB8fCBVdGlscy5jb2xvcjtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnN0cm9rZUNvbG9yID0gdGhpcy5vcHRpb25zLnN0cm9rZUNvbG9yIHx8IFV0aWxzLnN0cm9rZUNvbG9yO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBkcmF3KCkgeyByZXR1cm4gdGhpcy5fZHJhdzsgfVxyXG4gICAgc2V0IGRyYXcoczogYm9vbGVhbikge1xyXG4gICAgICAgIGlmKCFzICYmICF0aGlzLmRyYXcpIHJldHVybjtcclxuICAgICAgICB0aGlzLl9kcmF3ID0gcztcclxuICAgICAgICB0aGlzLmNhbnZhc0hhbmRlci5kcmF3KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0KCl7XHJcbiAgICAgICAgdGhpcy5jYW52YXNIYW5kZXIgPSBuZXcgQ2FudmFzSGFuZGxlcih0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlKHg6IG51bWJlciwgeTogbnVtYmVyKXtcclxuICAgICAgICB0aGlzLmRpclZlY3RvciA9IG5ldyBWZWN0b3IoeCwgeSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5kaXNwYXRjaChcImNoYW5nZVwiLCB0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwdWJsaWMgZnVuY3Rpb25zIGZvciB1c2Vyc1xyXG4gICAgZGlyZWN0aW9uVmVjdG9yICgpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IHRoaXMuZGlyVmVjdG9yLngsXHJcbiAgICAgICAgICAgIHk6IHRoaXMuZGlyVmVjdG9yLnlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZGlyZWN0aW9uQW5nbGVSYWRzKCk6IGFueSB7XHJcbiAgICAgICAgaWYodGhpcy5kaXJWZWN0b3IubGVuZ3RoKCkgPT09IDApXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpclZlY3Rvci50b0FuZ2xlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGRpcmVjdGlvbkFuZ2xlRGVncygpOiBhbnkge1xyXG4gICAgICAgIGlmKHRoaXMuZGlyZWN0aW9uQW5nbGVSYWRzKCkpXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbkFuZ2xlUmFkcygpICogMTgwIC8gTWF0aC5QSTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBkaXJlY3Rpb24oKTogYW55IHtcclxuICAgICAgICBpZih0aGlzLmRpcmVjdGlvbkFuZ2xlUmFkcygpKXtcclxuICAgICAgICAgICAgY29uc3QgYW5nbGU6IG51bWJlciA9IE1hdGgucm91bmQodGhpcy5kaXJlY3Rpb25BbmdsZURlZ3MoKSkgKyA0NTA7XHJcbiAgICAgICAgICAgIHZhciB2YWw6IG51bWJlciA9IE1hdGguZmxvb3IoKGFuZ2xlIC8gMjIuNSkgKyAwLjUpO1xyXG4gICAgICAgICAgICB2YXIgYXJyOiBBcnJheTxzdHJpbmc+ID0gW1wiTlwiLCBcIk5ORVwiLCBcIk5FXCIsIFwiRU5FXCIsIFwiRVwiLCBcIkVTRVwiLCBcIlNFXCIsIFwiU1NFXCIsIFwiU1wiLCBcIlNTV1wiLCBcIlNXXCIsIFwiV1NXXCIsIFwiV1wiLCBcIldOV1wiLCBcIk5XXCIsIFwiTk5XXCJdO1xyXG4gICAgICAgICAgICByZXR1cm4gYXJyWyh2YWwgJSAxNildO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZGlzcGxhY2VtZW50VmFsdWUoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kaXJWZWN0b3IubGVuZ3RoKCk7XHJcbiAgICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==